<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ï≤≠ÎùºÌïòÎäòÎåÄÍµê Í±∑Í∏∞ Ï±åÎ¶∞ÏßÄ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

:root {
    --blue: #1a6fe8;
    --blue-light: #4facfe;
    --accent: #ff5722;
    --bg: #f0f5ff;
    --card: #ffffff;
    --text: #1a1a2e;
    --gray: #8892a4;
}

body {
    font-family: 'Noto Sans KR', sans-serif;
    background: var(--bg);
    min-height: 100vh;
    padding: 20px 16px 40px;
}

.top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.top-bar .title {
    font-size: 15px;
    font-weight: 900;
    color: var(--blue);
    letter-spacing: -0.3px;
}

.top-bar .stamp-badge {
    background: var(--blue);
    color: white;
    font-size: 12px;
    font-weight: 700;
    border-radius: 20px;
    padding: 5px 12px;
}

.bridge-card {
    background: var(--card);
    border-radius: 20px;
    padding: 22px 20px 18px;
    margin-bottom: 14px;
    box-shadow: 0 4px 20px rgba(26,111,232,0.10);
}

.bridge-label {
    font-size: 11px;
    font-weight: 700;
    color: var(--gray);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 14px;
}

.bridge-wrap {
    position: relative;
    width: 100%;
    height: 90px;
}

.bridge-wrap svg {
    width: 100%;
    height: 100%;
}

.bridge-distance {
    margin-top: 12px;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
}

.bridge-distance .current {
    font-size: 28px;
    font-weight: 900;
    color: var(--blue);
    letter-spacing: -1px;
    line-height: 1;
}

.bridge-distance .current span {
    font-size: 14px;
    font-weight: 700;
    color: var(--gray);
    margin-left: 2px;
}

.bridge-distance .total {
    font-size: 12px;
    color: var(--gray);
}

.points-card {
    background: linear-gradient(135deg, var(--blue) 0%, #0a3fa8 100%);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 14px;
    box-shadow: 0 6px 24px rgba(26,111,232,0.30);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.points-label {
    font-size: 12px;
    color: rgba(255,255,255,0.7);
    font-weight: 700;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
}

.points-value {
    font-size: 36px;
    font-weight: 900;
    color: white;
    letter-spacing: -1px;
    line-height: 1;
}

.points-value span {
    font-size: 16px;
    font-weight: 700;
    opacity: 0.8;
    margin-left: 2px;
}

.points-icon {
    font-size: 40px;
    opacity: 0.4;
}

.btn-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
}

.btn-main {
    border: none;
    border-radius: 16px;
    padding: 18px 12px;
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.12s, box-shadow 0.12s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
}

.btn-main:active { transform: scale(0.97); }
.btn-main .btn-icon { font-size: 24px; }

.btn-start {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: white;
    box-shadow: 0 4px 16px rgba(34,197,94,0.35);
}

.btn-stop {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
    box-shadow: 0 4px 16px rgba(239,68,68,0.35);
}

.status-bar {
    background: var(--card);
    border-radius: 14px;
    padding: 14px 18px;
    margin-bottom: 12px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    display: flex;
    align-items: center;
    gap: 10px;
}

.status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--gray);
    flex-shrink: 0;
    transition: background 0.3s;
}

.status-dot.active { background: #22c55e; box-shadow: 0 0 0 3px rgba(34,197,94,0.2); }
.status-dot.error  { background: #ef4444; }

.status-text {
    font-size: 13px;
    font-weight: 700;
    color: var(--text);
    flex: 1;
}

.coords-text {
    font-size: 10px;
    color: var(--gray);
}

.bottom-grid {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 12px;
}

.btn-secondary {
    border: none;
    border-radius: 14px;
    padding: 15px 12px;
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.12s;
}
.btn-secondary:active { transform: scale(0.97); }

.btn-reset {
    background: #94a3b8;
    color: #ffffff;
}

.btn-shop {
    background: linear-gradient(135deg, #ff9800, var(--accent));
    color: white;
    font-size: 15px;
    box-shadow: 0 4px 16px rgba(255,87,34,0.30);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.stamps-wrap {
    margin-top: 16px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
}

.stamp {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--blue-light, #4facfe), var(--blue));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
    box-shadow: 0 2px 8px rgba(26,111,232,0.30);
}
</style>
</head>
<body>

<div class="top-bar">
    <div class="title">üåâ Ï≤≠ÎùºÌïòÎäòÎåÄÍµê Ï±åÎ¶∞ÏßÄ</div>
    <div class="stamp-badge" id="stampBadge">ÏôÑÏ£º 0Ìöå</div>
</div>

<!-- Îã§Î¶¨ ÏãúÍ∞ÅÌôî -->
<div class="bridge-card">
    <div class="bridge-label">Îü¨Îãù Í±∞Î¶¨</div>
    <div class="bridge-wrap">
        <svg id="bridgeSvg" viewBox="0 0 320 90" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <linearGradient id="progressGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#4facfe"/>
                    <stop offset="100%" style="stop-color:#1a6fe8"/>
                </linearGradient>
            </defs>

            <!-- Î∞∞Í≤Ω ÎèÑÎ°ú -->
            <rect x="10" y="58" width="300" height="6" rx="3" fill="#e2e8f0"/>

            <!-- ÏôºÏ™Ω ÌÉÄÏõå -->
            <rect x="72" y="18" width="5" height="46" rx="2" fill="#cbd5e1"/>
            <!-- Ïò§Î•∏Ï™Ω ÌÉÄÏõå -->
            <rect x="243" y="18" width="5" height="46" rx="2" fill="#cbd5e1"/>

            <!-- ÏôºÏ™Ω ÌÉÄÏõå ÏºÄÏù¥Î∏î -->
            <line x1="74" y1="20" x2="20" y2="62" stroke="#cbd5e1" stroke-width="1.5"/>
            <line x1="74" y1="20" x2="50" y2="62" stroke="#cbd5e1" stroke-width="1.5"/>
            <line x1="74" y1="20" x2="100" y2="62" stroke="#cbd5e1" stroke-width="1.5"/>
            <line x1="74" y1="20" x2="130" y2="62" stroke="#cbd5e1" stroke-width="1.5"/>
            <line x1="74" y1="20" x2="158" y2="62" stroke="#cbd5e1" stroke-width="1.5"/>

            <!-- Ïò§Î•∏Ï™Ω ÌÉÄÏõå ÏºÄÏù¥Î∏î -->
            <line x1="246" y1="20" x2="162" y2="62" stroke="#cbd5e1" stroke-width="1.5"/>
            <line x1="246" y1="20" x2="190" y2="62" stroke="#cbd5e1" stroke-width="1.5"/>
            <line x1="246" y1="20" x2="220" y2="62" stroke="#cbd5e1" stroke-width="1.5"/>
            <line x1="246" y1="20" x2="270" y2="62" stroke="#cbd5e1" stroke-width="1.5"/>
            <line x1="246" y1="20" x2="300" y2="62" stroke="#cbd5e1" stroke-width="1.5"/>

            <!-- ÏßÑÌñâ ÌååÎûÄ ÏÑ† -->
            <rect id="progressTrack" x="10" y="58" width="0" height="6" rx="3" fill="url(#progressGrad)"/>

            <!-- Ï∂úÎ∞úÏ†ê Ï†ê -->
            <circle cx="10" cy="61" r="6" fill="#4facfe" stroke="white" stroke-width="2"/>

            <!-- Îü¨ÎÑà (JSÎ°ú Ïù¥Îèô) -->
            <text id="runnerIcon" x="10" y="54" font-size="14" text-anchor="middle">üèÉ</text>

            <!-- ÎèÑÏ∞© ÍπÉÎ∞ú -->
            <text x="310" y="54" font-size="14" text-anchor="middle">üèÅ</text>

            <!-- ÎùºÎ≤® -->
            <text x="10" y="82" font-size="9" fill="#94a3b8" text-anchor="middle">Ï∂úÎ∞ú</text>
            <text x="310" y="82" font-size="9" fill="#94a3b8" text-anchor="middle">ÎèÑÏ∞©</text>
        </svg>
    </div>
    <div class="bridge-distance">
        <div class="current"><span id="distanceVal">0.000</span><span>km</span></div>
        <div class="total">Ï¥ù ÏïΩ 4.67km</div>
    </div>
</div>

<!-- ÎàÑÏ†Å Ìè¨Ïù∏Ìä∏ -->
<div class="points-card">
    <div>
        <div class="points-label">ÎàÑÏ†Å Ìè¨Ïù∏Ìä∏</div>
        <div class="points-value"><span id="pointsVal">0</span><span>P</span></div>
    </div>
    <div class="points-icon">ü™ô</div>
</div>

<!-- Î≤ÑÌäº -->
<div class="btn-grid">
    <button class="btn-main btn-start" onclick="startTracking()">
        <span class="btn-icon">üèÉ</span>Îü¨Îãù ÏãúÏûë
    </button>
    <button class="btn-main btn-stop" onclick="stopTracking()">
        <span class="btn-icon">‚èπ</span>Îü¨Îãù Ï§ëÏßÄ
    </button>
</div>

<!-- ÏÉÅÌÉú -->
<div class="status-bar">
    <div class="status-dot" id="statusDot"></div>
    <div>
        <div class="status-text" id="statusText">ÎåÄÍ∏∞ Ï§ë</div>
        <div class="coords-text" id="coords"></div>
    </div>
</div>

<!-- ÌïòÎã® Î≤ÑÌäº -->
<div class="bottom-grid">
    <button class="btn-secondary btn-reset" id="resetBtn">Í∏∞Î°ù Ï¥àÍ∏∞Ìôî</button>
    <button class="btn-secondary btn-shop" onclick="location.href='shop.html'">üéÅ Ìè¨Ïù∏Ìä∏ ÏÇ¨Ïö©</button>
</div>

<!-- ÎèÑÏû• -->
<div class="stamps-wrap" id="stamps"></div>

<script>
const BRIDGE_TOTAL_KM = 4.67;
const bridgeStart = { lat: 37.5173, lng: 126.6028 };
const bridgeEnd   = { lat: 37.5059, lng: 126.5740 };
const radius = 0.3;

let watchId = null;
let measuring = false;
let prevPosition = null;
let totalDistance = 0;

let totalPoints   = Number(localStorage.getItem("points")) || 0;
let stampCount    = Number(localStorage.getItem("stamps")) || 0;
let savedDistance = Number(localStorage.getItem("currentDistance")) || 0;

totalDistance = savedDistance;
updateUI();

function updateUI() {
    document.getElementById("pointsVal").innerText = totalPoints;
    document.getElementById("distanceVal").innerText = totalDistance.toFixed(3);
    document.getElementById("stampBadge").innerText = "ÏôÑÏ£º " + stampCount + "Ìöå";
    updateBridgeProgress(totalDistance);
    renderStamps();
}

function updateBridgeProgress(km) {
    const ratio = Math.min(km / BRIDGE_TOTAL_KM, 1);
    const trackWidth = 300 * ratio;
    const runnerX = 10 + 300 * ratio;
    document.getElementById("progressTrack").setAttribute("width", trackWidth);
    document.getElementById("runnerIcon").setAttribute("x", Math.min(runnerX, 305));
}

function updateStatus(text, type) {
    document.getElementById("statusText").innerText = text;
    const dot = document.getElementById("statusDot");
    dot.className = "status-dot";
    if (type === "active") dot.classList.add("active");
    if (type === "error")  dot.classList.add("error");
}

function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2-lat1) * Math.PI/180;
    const dLon = (lon2-lon1) * Math.PI/180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function isNear(point, current) {
    return calculateDistance(point.lat, point.lng, current.lat, current.lng) < radius;
}

function startTracking() {
    if (!navigator.geolocation) { updateStatus("GPS ÎØ∏ÏßÄÏõê", "error"); return; }
    updateStatus("Îã§Î¶¨ ÏãúÏûëÏ†ê ÎåÄÍ∏∞ Ï§ë...", "idle");

    watchId = navigator.geolocation.watchPosition(position => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        const accuracy = position.coords.accuracy;

        document.getElementById("coords").innerText =
            lat.toFixed(5) + ", " + lng.toFixed(5) + " (¬±" + Math.round(accuracy) + "m)";

        const current = { lat, lng };

        if (!measuring && (isNear(bridgeStart, current) || isNear(bridgeEnd, current))) {
            measuring = true;
            prevPosition = current;
            updateStatus("üìç Ï∏°Ï†ï ÏãúÏûë!", "active");
            return;
        }

        if (measuring && prevPosition) {
            if (accuracy > 30) return;
            const dist = calculateDistance(prevPosition.lat, prevPosition.lng, lat, lng);
            if (dist < 0.003) return;
            if (dist > 0.03) return;

            totalDistance += dist;
            prevPosition = current;
            localStorage.setItem("currentDistance", totalDistance);

            document.getElementById("distanceVal").innerText = totalDistance.toFixed(3);
            updateBridgeProgress(totalDistance);

            if (isNear(bridgeEnd, current)) completeChallenge();
        }

    }, error => {
        updateStatus("ÏúÑÏπò Ïò§Î•ò: " + error.message, "error");
    }, { enableHighAccuracy: true });
}

function completeChallenge() {
    if (watchId !== null) navigator.geolocation.clearWatch(watchId);
    measuring = false;

    const earned = Math.floor(totalDistance * 100) + 50;
    totalPoints += earned;
    stampCount++;

    localStorage.setItem("points", totalPoints);
    localStorage.setItem("stamps", stampCount);
    localStorage.removeItem("currentDistance");

    totalDistance = 0;
    updateUI();
    updateStatus("üéâ ÏôÑÏ£º ÏÑ±Í≥µ! +" + earned + "P", "active");
}

function stopTracking() {
    if (watchId !== null) navigator.geolocation.clearWatch(watchId);

    if (measuring) {
        const earned = Math.floor(totalDistance * 100);
        totalPoints += earned;
        localStorage.setItem("points", totalPoints);
        localStorage.removeItem("currentDistance");
        updateStatus("Ï§ëÏßÄ ‚Äî +" + earned + "P", "idle");
    } else {
        updateStatus("Ï∏°Ï†ï ÏãúÏûë Ï†Ñ Ï¢ÖÎ£å", "idle");
    }

    measuring = false;
    totalDistance = 0;
    prevPosition = null;
    document.getElementById("distanceVal").innerText = "0.000";
    document.getElementById("pointsVal").innerText = totalPoints;
    updateBridgeProgress(0);
}

function renderStamps() {
    const container = document.getElementById("stamps");
    container.innerHTML = "";
    for (let i = 0; i < stampCount; i++) {
        const s = document.createElement("div");
        s.className = "stamp";
        s.innerText = "‚úì";
        container.appendChild(s);
    }
}

document.getElementById("resetBtn").addEventListener("click", function () {
    if (confirm("Î™®Îì† Í∏∞Î°ùÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) {
        localStorage.clear();
        totalPoints = 0; stampCount = 0; totalDistance = 0;
        updateUI();
        updateStatus("Í∏∞Î°ù Ï¥àÍ∏∞Ìôî ÏôÑÎ£å", "idle");
    }
});
</script>

</body>
</html>






